<apex:page docType="html-5.0"
sidebar="false" 
showheader="false"
standardStylesheets="false"
Controller="ProjectController"
applyHtmlTag="false"
applyBodyTag="false"
>
<html ng-app="taskyApp">
<head>
  <title> Tasky </title>
  <apex:stylesheet value="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400"/>
  <meta name="viewport" content="width=device-width, initial-scale=1,  minimum-scale=1, maximum-scale=1, user-scalable=no"/>
  <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.1.5/angular.js"> </script>
  <apex:includeScript value="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"/>
  <apex:includeScript value="{!URLFOR($Resource.ChecklistAssets, 'forceTK/forceTK.js')}"/>
  <apex:includeScript value="{!URLFOR($Resource.RollCallAssets, 'fastclick/fastclick.js')}"/>
</head>
</html>

<body>
    <div ng-controller="ProjectCtrl">
        <h1> Tasky </h1>
        <p> Select a Project </p>
        <div ng-repeat="project in projects" ng-click="getTasks(project.Id)"> 
            <p > {{project.Name}} </p>
            <p> {{project.Description__c}} </p>
        </div>
        <div ng-repeat="task in tasks">
                        <p > {{task.Name}} </p>
        </div>
        <input ng-model="projName"></input>
        <input ng-model="description"></input>
        <button ng-click="createProject(projName, description)"> {{projName}}</button>

    </div>

</body>


<script>
/** Angular Script */
var checklistApp = angular.module('taskyApp', []);

checklistApp.controller('ProjectCtrl', function($scope) {

    /** An array of Projects. */
    $scope.projects = [];
    /** An array of Tasks. */
    $scope.tasks = [];


    /** Takes COLLABORATORS and gets project information from them. */
    var createProjectsFromCollaborators = function(collaborators) {
        for(var i = 0; i < collaborators.length; i++) {
            $scope.projects[i] = collaborators[i].Project__r;
        }
    }


    /** Gets all Collaborators that look up to current user. */
    var getUserCollaborators = function() {
        Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.ProjectController.getUserCollaborators}',
            function(result, event) {
                if (event.status) {
                    createProjectsFromCollaborators(result);
                    $scope.$apply();
                } else if (event.type === 'exception') {
                    console.log('exception');
                } else {
                    console.log('error');
                }
            }
            );
    }

    $scope.getTasks = function(projectId) {
        console.log('start');
        Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.ProjectController.getTasks}',
            projectId,
            function(result, event) {
                if (event.status) {
                    console.log(result);
                    $scope.tasks = result;
                    $scope.$apply();
                } else if (event.type === 'exception') {
                    console.log('exception');
                } else {
                    console.log('error');
                }
            }
            );
    }

    $scope.createProject = function(name, description) {
        Visualforce.remoting.Manager.invokeAction(
            '{!$RemoteAction.ProjectController.createProject}',
            name,
            description,
            function(result, event) {
                if (event.status) {
                    console.log('Create Project')
                    $scope.$apply();
                } else if (event.type === 'exception') {
                    console.log('exception');
                } else {
                    console.log('error');
                }
            }
            );
    }

    getUserCollaborators();


});

</script>
</apex:page>